import React, { useState } from 'react';
import { unreportQuestion } from '@/lib/api/Questions';
import { showConfirm, showAlert } from '@/lib/utils/showAlert';
import { useLogout } from '@/lib/hooks/useLogout';

interface Question {
  id: string | number;
  text?: string;
  isReported?: boolean;
  [key: string]: any;
}

interface ReportProps {
  question: Question;
  token: string;
  onIgnoreSuccess?: () => void;
}

export const Report: React.FC<ReportProps> = ({ question, token, onIgnoreSuccess }) => {
  const { logout } = useLogout();
  const [reported, setReported] = useState(question.isReported || false);

  const confirmBlock = async () => {
    showConfirm(
      '¿Estás Seguro?',
      '¿Deseas ignorar una pregunta?',
      'Ignorar',
      async () => {
        try {
          await unreportQuestion(question.id.toString(), token);
          
          setReported(false);
          
          showAlert(
            'Operación Exitosa',
            'Se ha ignorado la pregunta',
            'success'
          ).then(() => {
            if (onIgnoreSuccess) {
              onIgnoreSuccess();
            } else {
              window.location.reload();
            }
          });
          
        } catch (error: any) {
          if (error?.response?.data?.message === 'Token expirado') {
            showAlert(
              'Inicio de sesión expirado',
              'Vuelve a ingresar a la plataforma',
              'error'
            ).then(() => {
              logout();
            });
            return;
          }
          
          showAlert('Error', 'Estamos teniendo fallas técnicas', 'error');
        }
      }
    );
  };

  if (!reported) return null;

  return (
    <svg 
      xmlns="http://www.w3.org/2000/svg" 
      width="25" 
      height="22" 
      viewBox="0 0 25 22" 
      fill="none"
      style={{cursor: "pointer"}} 
      onClick={confirmBlock}
    >
      <path d="M21.1846 16.1176L17.5344 9.65093L13.8829 3.18316C13.6963 2.85239 13.4277 2.57771 13.1043 2.38673C12.7809 2.19576 12.4141 2.09521 12.0407 2.09521C11.6673 2.09521 11.3004 2.19576 10.977 2.38673C10.6536 2.57771 10.3851 2.85239 10.1984 3.18316L6.54693 9.65097L2.89728 16.1175C2.71061 16.4481 2.61233 16.8233 2.6123 17.2051C2.61228 17.587 2.71051 17.9621 2.89712 18.2928C3.08374 18.6235 3.35217 18.8982 3.67544 19.0892C3.99871 19.2802 4.36544 19.3808 4.73877 19.3809H19.3416C19.7151 19.381 20.0819 19.2806 20.4054 19.0897C20.7288 18.8988 20.9975 18.6242 21.1842 18.2934C21.371 17.9627 21.4694 17.5875 21.4694 17.2055C21.4695 16.8236 21.3713 16.4484 21.1846 16.1176Z" fill="#FFD21F"/>
      <path d="M15.956 2.25507C15.5589 1.56943 14.9878 1.00008 14.3002 0.604236C13.6125 0.208392 12.8324 0 12.0384 0C11.2444 0 10.4643 0.208392 9.77663 0.604236C9.08895 1.00008 8.51788 1.56943 8.12079 2.25507L4.36328 8.7443L0.605776 15.2335C0.208867 15.9193 -5.55645e-05 16.6971 1.10849e-08 17.4889C5.55867e-05 18.2807 0.209087 19.0585 0.606093 19.7442C1.0031 20.4299 1.5741 20.9993 2.26171 21.3953C2.94933 21.7913 3.72935 21.9998 4.52341 22H19.5533C20.3474 21.9998 21.1274 21.7912 21.815 21.3953C22.5026 20.9993 23.0736 20.4298 23.4706 19.7441C23.8676 19.0584 24.0766 18.2806 24.0767 17.4889C24.0767 16.6971 23.8678 15.9193 23.4709 15.2335L15.956 2.25507ZM22.7839 19.3482C22.4599 19.9166 21.9897 20.3887 21.4219 20.7157C20.8541 21.0428 20.2091 21.2131 19.5533 21.209H4.52341C3.86859 21.2088 3.22536 21.0368 2.65833 20.7102C2.0913 20.3837 1.62045 19.9141 1.29307 19.3486C0.965695 18.7831 0.793326 18.1417 0.793283 17.4888C0.79324 16.8358 0.965524 16.1944 1.29283 15.6289L8.80784 2.65043C9.49207 1.46884 10.6695 0.79094 12.0384 0.79094C13.4086 0.79094 14.586 1.4686 15.2688 2.65018L22.7839 15.629C23.1154 16.193 23.2901 16.8349 23.2901 17.4886C23.2901 18.1423 23.1154 18.7842 22.7839 19.3482ZM18.3803 9.51282L14.6222 3.02295C14.0746 2.07793 13.1329 1.53598 12.0385 1.53598C10.9449 1.53598 10.0037 2.07793 9.45607 3.02305L5.69779 9.51297L1.94106 16.0013C1.39343 16.9464 1.39343 18.0305 1.94106 18.9755C2.48868 19.9206 3.42984 20.4625 4.52341 20.4625H19.5533C20.6477 20.4625 21.5896 19.9205 22.1371 18.9755C22.6846 18.0305 22.6847 16.9463 22.1371 16.0013L18.3803 9.51282ZM21.4502 18.5798C21.2618 18.9152 20.9862 19.1936 20.6523 19.3858C20.3185 19.5779 19.9388 19.6766 19.5533 19.6714H4.52341C4.13915 19.6713 3.7617 19.5704 3.42898 19.3787C3.09625 19.187 2.81997 18.9115 2.6279 18.5796C2.43583 18.2478 2.33472 17.8714 2.33475 17.4882C2.33478 17.1051 2.43593 16.7287 2.62806 16.3969L6.3848 9.90838L10.1431 3.41856C10.3352 3.08666 10.6116 2.81105 10.9445 2.61942C11.2773 2.4278 11.6549 2.32692 12.0392 2.32692C12.4236 2.32692 12.8012 2.4278 13.134 2.61942C13.4669 2.81105 13.7432 3.08666 13.9354 3.41856L17.6937 9.90833L21.4502 16.397C21.6475 16.727 21.7516 17.1041 21.7516 17.4884C21.7516 17.8726 21.6475 18.2498 21.4502 18.5798ZM12.0384 6.90048C11.8145 6.90113 11.5931 6.94675 11.3873 7.03461C11.1814 7.12248 10.9955 7.25078 10.8405 7.41187C10.694 7.56158 10.5797 7.73955 10.5046 7.93487C10.4295 8.13018 10.3953 8.33873 10.4039 8.54773L10.5937 12.8669C10.6288 13.6652 11.2634 14.2907 12.0384 14.2907C12.8083 14.2907 13.4435 13.6667 13.4846 12.8669L13.673 8.54852C13.682 8.3397 13.6482 8.13123 13.5735 7.93594C13.4988 7.74064 13.3848 7.56265 13.2385 7.41291C13.0833 7.25142 12.8971 7.1228 12.6908 7.03475C12.4846 6.9467 12.2627 6.90104 12.0384 6.90048ZM12.6922 12.8295C12.6723 13.2116 12.3915 13.4997 12.0384 13.4997C11.6892 13.4997 11.4027 13.2066 11.3862 12.8323L11.1964 8.51327C11.1928 8.41097 11.2102 8.30902 11.2476 8.21367C11.2849 8.11831 11.3413 8.03155 11.4134 7.95871C11.4941 7.87417 11.5912 7.80686 11.6988 7.76089C11.8064 7.71492 11.9222 7.69124 12.0393 7.69129C12.1563 7.69134 12.2721 7.71512 12.3797 7.76119C12.4872 7.80725 12.5843 7.87464 12.6649 7.95926C12.7368 8.03203 12.793 8.11869 12.83 8.21391C12.8671 8.30913 12.8842 8.41091 12.8803 8.51297L12.6922 12.8295ZM12.0384 14.6713C11.7524 14.6715 11.4728 14.7563 11.2351 14.9149C10.9974 15.0736 10.8122 15.2989 10.7029 15.5625C10.5936 15.8261 10.5651 16.1161 10.6211 16.3958C10.677 16.6755 10.8149 16.9324 11.0172 17.134C11.2196 17.3356 11.4773 17.4728 11.7579 17.5284C12.0385 17.5839 12.3293 17.5553 12.5935 17.4461C12.8578 17.3369 13.0836 17.152 13.2425 16.9148C13.4014 16.6777 13.4862 16.3989 13.4862 16.1136C13.4858 15.731 13.3331 15.3642 13.0616 15.0938C12.7901 14.8233 12.4221 14.6714 12.0384 14.6713ZM12.0384 16.7649C11.9093 16.7647 11.7831 16.7263 11.6758 16.6546C11.5686 16.5828 11.485 16.481 11.4358 16.362C11.3865 16.2429 11.3738 16.112 11.3991 15.9857C11.4245 15.8595 11.4868 15.7435 11.5782 15.6525C11.6696 15.5616 11.786 15.4997 11.9127 15.4746C12.0394 15.4496 12.1707 15.4626 12.29 15.5119C12.4093 15.5613 12.5112 15.6448 12.5829 15.7519C12.6546 15.859 12.6929 15.9849 12.6929 16.1136C12.6927 16.2865 12.6236 16.4523 12.5009 16.5744C12.3782 16.6965 12.2118 16.7651 12.0384 16.7649Z" fill="#25293D"/>
      <path d="M15.2588 2.58585C14.5789 1.40588 13.4064 0.729004 12.0421 0.729004C10.6791 0.729004 9.50654 1.40583 8.82522 2.58595L1.34215 15.5468C1.01624 16.1115 0.844684 16.7521 0.844727 17.4041C0.844769 18.0562 1.01641 18.6967 1.34239 19.2614C1.66838 19.8261 2.13724 20.2951 2.70186 20.6212C3.26648 20.9473 3.90699 21.1191 4.55902 21.1193H19.5252C20.1772 21.1191 20.8177 20.9473 21.3823 20.6212C21.9469 20.2951 22.4157 19.8261 22.7417 19.2615C23.0677 18.6968 23.2394 18.0563 23.2394 17.4042C23.2395 16.7522 23.0679 16.1117 22.742 15.5469L15.2588 2.58585ZM22.0979 18.8889C21.5527 19.8325 20.6149 20.3738 19.5252 20.3738H4.55902C3.47009 20.3738 2.53283 19.8325 1.98763 18.8889C1.44242 17.9452 1.44227 16.8625 1.98763 15.9187L5.72842 9.43915L9.47075 2.95811C10.0161 2.01428 10.9533 1.47308 12.0422 1.47308C13.132 1.47308 14.0697 2.01428 14.6149 2.95801L18.3572 9.439L22.0981 15.9187C22.6433 16.8625 22.6433 17.9451 22.0979 18.8889Z" fill="#FF914C"/>
      <path d="M12.0418 15.3802C11.9132 15.3805 11.7876 15.4189 11.6808 15.4905C11.574 15.5621 11.4908 15.6638 11.4417 15.7826C11.3927 15.9015 11.38 16.0323 11.4052 16.1584C11.4305 16.2845 11.4925 16.4002 11.5835 16.4911C11.6745 16.5819 11.7905 16.6438 11.9166 16.6688C12.0427 16.6938 12.1735 16.6808 12.2922 16.6315C12.411 16.5823 12.5125 16.4989 12.584 16.392C12.6554 16.285 12.6935 16.1593 12.6935 16.0307C12.6933 15.858 12.6245 15.6925 12.5023 15.5705C12.3801 15.4486 12.2145 15.3801 12.0418 15.3802Z" fill="#FF914C"/>
      <path d="M12.0413 7.62012C11.925 7.62059 11.8099 7.64447 11.7031 7.69035C11.5962 7.73623 11.4996 7.80317 11.4192 7.88717C11.3474 7.9599 11.2912 8.04654 11.254 8.14176C11.2168 8.23699 11.1995 8.3388 11.2031 8.44096L11.392 12.7541C11.4084 13.1277 11.6937 13.4206 12.0415 13.4206C12.3931 13.4206 12.6729 13.1328 12.6925 12.7513L12.8801 8.44121C12.8839 8.33928 12.8669 8.23764 12.83 8.14254C12.7931 8.04745 12.7371 7.96091 12.6655 7.88825C12.5849 7.80383 12.488 7.73657 12.3808 7.69049C12.2735 7.64442 12.158 7.62048 12.0413 7.62012Z" fill="#FF914C"/>
    </svg>
  );
};

export default Report;